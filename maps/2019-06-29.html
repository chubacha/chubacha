
    <!DOCTYPE html>
    <html>
      <head>
        <title>Track Map - Sat Jun 29 2019 01:00:00 GMT+0100 (British Summer Time)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet-kml/dist/leaflet-kml.js"></script>
        <script src="https://unpkg.com/leaflet-elevation/dist/leaflet-elevation.min.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/leaflet-elevation/dist/leaflet-elevation.min.css" />
        <style>
          body { margin: 0; padding: 0; }
          html, body, #map { height: 50%; margin-bottom: 20px; }
          #elevation { width: 100%; height: 200px; }
        </style>
      </head>
      <body>
        <h2>Track Map - Day Sat Jun 29 2019 01:00:00 GMT+0100 (British Summer Time)</h2>
        <div id="map"></div>
        <div id="elevation"></div>

        <script>
          var map = L.map('map').setView([51.505, -0.09], 13);
          L.tileLayer('https://tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=0952b4b77c244683b65c482658d6dcce', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
                         '<a href="https://www.thunderforest.com/">Thunderforest</a>',
            maxZoom: 19
          }).addTo(map);

          var kmlLayer = new L.KML("https://drive.google.com/uc?id=1mzX7YFAh6nEe7o_c6JdIkZBF48j8hwed", {async: true});
          kmlLayer.on('loaded', function(e) {
            var bounds = e.target.getBounds();
            var zoomLevel = map.getBoundsZoom(bounds);
            map.setView(bounds.getCenter(), zoomLevel);
            var coords = extractCoordinatesAndElevation(e.target);
            createElevationProfile(coords);
            map.fitBounds(bounds);
          });
          kmlLayer.addTo(map);

          function extractCoordinatesAndElevation(kmlLayer) {
            var coords = [];
            kmlLayer.eachLayer(function(layer) {
              var latlngs = layer.getLatLngs();
              latlngs.forEach(function(latlng) {
                var elevation = latlng.alt;
                coords.push([latlng.lng, latlng.lat, elevation]);
              });
            });
            return coords;
          }

          function createElevationProfile(coords) {
            var elevation = L.elevation({
              theme: "steelblue",
              width: 400,
              height: 120,
              margins: { top: 10, right: 10, bottom: 10, left: 10 },
              legend: true
            }).addTo(map);
            var elevationData = coords.map(function(coord) {
              return [coord[0], coord[1], coord[2]];
            });
            elevation.addData(elevationData);
          }
        </script>
      </body>
    </html>
  